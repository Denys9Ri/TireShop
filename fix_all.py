import os
import django
from django.db import connection

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'TireShop.settings')
django.setup()

print("üöë –ü–æ—á–∏–Ω–∞—é –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–π —Ä–µ–º–æ–Ω—Ç –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...")

with connection.cursor() as cursor:
    # 1. –î–æ–¥–∞—î–º–æ –∫–æ–ª–æ–Ω–∫—É –ó–Ω–∏–∂–∫–∏ (discount_percent)
    print("--> –î–æ–¥–∞—é –∫–æ–ª–æ–Ω–∫—É discount_percent...")
    try:
        cursor.execute("ALTER TABLE store_product ADD COLUMN IF NOT EXISTS discount_percent integer NOT NULL DEFAULT 0;")
        print("   OK.")
    except Exception as e:
        print(f"   (–í–∂–µ —î –∞–±–æ –ø–æ–º–∏–ª–∫–∞): {e}")

    # 2. –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –ë–∞–Ω–µ—Ä—ñ–≤ (SiteBanner)
    print("--> –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Ç–∞–±–ª–∏—Ü—é SiteBanner...")
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS store_sitebanner (
            id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
            title varchar(100) NOT NULL,
            image varchar(100),
            image_url varchar(1024),
            link varchar(200),
            is_active boolean NOT NULL DEFAULT true,
            created_at timestamp with time zone NOT NULL DEFAULT NOW()
        );
    ''')

    # 3. –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (SiteSettings)
    print("--> –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Ç–∞–±–ª–∏—Ü—é SiteSettings...")
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS store_sitesettings (
            id bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
            global_markup numeric(5, 2) NOT NULL
        );
    ''')

print("‚úÖ –†–µ–º–æ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –í—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –º—ñ—Å—Ü—ñ.")
