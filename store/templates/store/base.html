<!DOCTYPE html>
{% load static %}
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F63L5ESNN8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-F63L5ESNN8');
    </script>

    <meta name="google-site-verification" content="D2aRaIcWDhooWV3K4uewL2EB9D3BUfH3t5M6hr7uL0I" />
    <meta name="description" content="{% block meta_description %}–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —à–∏–Ω R16.com.ua. –ó–∏–º–æ–≤—ñ —Ç–∞ –ª—ñ—Ç–Ω—ñ —à–∏–Ω–∏, –¥–∏—Å–∫–∏. –°–∞–º–æ–≤–∏–≤—ñ–∑ —É –ö–∏—î–≤—ñ (–í—ñ–¥—Ä–∞–¥–Ω–∏–π), –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –£–∫—Ä–∞—ó–Ω—ñ. –ù–∏–∑—å–∫—ñ —Ü—ñ–Ω–∏, —à–∏—Ä–æ–∫–∏–π –≤–∏–±—ñ—Ä.{% endblock %}">

    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'images/favicon.png' %}">
    <link rel="apple-touch-icon" href="{% static 'images/favicon.png' %}">

    <title>{% block title %}R16.com.ua - –®–∏–Ω–∏ –õ—ñ—Ç–Ω—ñ, –ó–∏–º–æ–≤—ñ —Ç–∞ –í—Å–µ—Å–µ–∑–æ–Ω–Ω—ñ{% endblock %}</title>
    
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f0f4f8; margin: 0; font-family: system-ui, -apple-system, sans-serif; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- –®–ê–ü–ö–ê --- */
        .navbar { background-color: rgba(0, 74, 153, 0.9); backdrop-filter: blur(12px); padding: 8px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.15); }
        .logo-link { display: flex; align-items: center; gap: 10px; text-decoration: none; line-height: 0; }
        .logo-img { height: 55px; width: auto; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
        
        .navbar-menu { display: flex; gap: 20px; align-items: center; }
        .navbar-item { color: rgba(255, 255, 255, 0.95); text-decoration: none; font-weight: 600; font-size: 1rem; padding: 8px 0; position: relative; transition: color 0.3s; display: flex; align-items: center; gap: 8px; }
        .navbar-item:hover { color: #fff; }
        
        /* –í–∏–¥–∞–ª–µ–Ω–æ –∂–æ–≤—Ç—É –∫–Ω–æ–ø–∫—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, —Ç–µ–ø–µ—Ä —Ü–µ –∑–≤–∏—á–∞–π–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è */
        
        .hamburger { display: none; width: 36px; height: 36px; background: transparent; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; cursor: pointer; padding: 7px; flex-direction: column; justify-content: space-between; }
        .hamburger span { display: block; width: 100%; height: 2px; background-color: #ffffff; transition: 0.3s; }

        .mobile-menu { position: fixed; top: 0; right: -100%; width: 280px; height: 100vh; background-color: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); box-shadow: -5px 0 15px rgba(0,0,0,0.1); z-index: 1001; display: flex; flex-direction: column; padding: 80px 20px 20px; transition: right 0.3s ease; }
        .mobile-menu.is-active { right: 0; }
        .mobile-menu a, .mobile-menu button { display: block; padding: 15px; font-size: 1.1rem; color: #333; text-decoration: none; border-bottom: 1px solid #eee; font-weight: 600; display: flex; align-items: center; gap: 10px; background: none; border: none; width: 100%; text-align: left; cursor: pointer; }
        .logout-button-mobile { color: #dc3545 !important; }

        main { flex: 1; }
        
        /* –ß–æ—Ä–Ω–∏–π —Ñ—É—Ç–µ—Ä */
        .footer { background-color: #1a1a1a; color: #fff; padding: 40px 0 20px; text-align: center; margin-top: auto; }
        .schedule-block { background: rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; margin: 20px auto; max-width: 500px; font-size: 0.9rem; line-height: 1.6; }

        @media (max-width: 992px) { .navbar { padding: 8px 20px; } .logo-img { height: 40px; } .navbar-menu { display: none; } .hamburger { display: flex; } }
    </style>
</head>
<body>

<header class="navbar">
    <div class="navbar-brand">
        <a href="{% url 'catalog' %}" class="logo-link"><img src="{% static 'images/logo.png' %}" alt="R16 Logo" class="logo-img"></a>
    </div>
    
    <div class="navbar-menu">
        <a href="tel:+380666881491" style="color: #fff; text-decoration: none; font-weight: bold; margin-right: 10px;"><i class="bi bi-phone"></i> (066) 688-14-91</a>
        
        <a href="{% url 'about' %}" class="navbar-item">–ü—Ä–æ –Ω–∞—Å</a>
        <a href="{% url 'delivery_payment' %}" class="navbar-item">–î–æ—Å—Ç–∞–≤–∫–∞</a>
        <a href="{% url 'store:cart_detail' %}" class="navbar-item"><i class="bi bi-cart3" style="font-size: 1.3rem;"></i> –ö–æ—à–∏–∫ ({{ cart|length }})</a>
        
        <div style="border-left: 1px solid rgba(255,255,255,0.3); height: 20px; margin: 0 5px;"></div>

        {% if user.is_authenticated %}
            <a href="{% url 'users:profile' %}" class="navbar-item"><i class="bi bi-person-circle"></i> –ö–∞–±—ñ–Ω–µ—Ç</a>
            <form action="{% url 'logout' %}" method="post" style="display:inline;">{% csrf_token %}<button type="submit" class="navbar-item" style="background:none; border:none; cursor:pointer;">–í–∏–π—Ç–∏</button></form>
        {% else %}
            <a href="{% url 'login' %}" class="navbar-item" style="font-weight: normal; font-size: 0.95rem; opacity: 0.9;">–í—Ö—ñ–¥</a>
            <a href="{% url 'users:register' %}" class="navbar-item" style="font-weight: normal; font-size: 0.95rem; opacity: 0.9;">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
        {% endif %}
    </div>
    
    <button class="hamburger" id="hamburger-button"><span></span><span></span><span></span></button>
</header>

<div class="mobile-menu" id="mobile-menu">
    <a href="{% url 'catalog' %}"><i class="bi bi-shop"></i> –ö–∞—Ç–∞–ª–æ–≥</a>
    <a href="{% url 'about' %}"><i class="bi bi-info-circle"></i> –ü—Ä–æ –Ω–∞—Å</a>
    <a href="{% url 'contacts' %}"><i class="bi bi-telephone"></i> –ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
    <a href="{% url 'delivery_payment' %}"><i class="bi bi-truck"></i> –î–æ—Å—Ç–∞–≤–∫–∞ —ñ –æ–ø–ª–∞—Ç–∞</a>
    <a href="{% url 'store:cart_detail' %}"><i class="bi bi-cart3"></i> –ö–æ—à–∏–∫ ({{ cart|length }})</a>
    {% if user.is_authenticated %}
        <a href="{% url 'users:profile' %}"><i class="bi bi-person"></i> –ú—ñ–π –ö–∞–±—ñ–Ω–µ—Ç</a>
        <form action="{% url 'logout' %}" method="post">{% csrf_token %}<button type="submit" class="logout-button-mobile"><i class="bi bi-box-arrow-right"></i> –í–∏–π—Ç–∏</button></form>
    {% else %}
        <a href="{% url 'login' %}"><i class="bi bi-box-arrow-in-right"></i> –£–≤—ñ–π—Ç–∏</a>
        <a href="{% url 'users:register' %}"><i class="bi bi-person-plus"></i> –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
    {% endif %}
</div>

<main class="container">
    {% block content %}{% endblock %}
</main>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-brand"><p class="fs-4 fw-bold mb-1">R16.com.ua</p><p class="opacity-75 small">–®–∏–Ω–∏ —Ç–∞ —Å–µ—Ä–≤—ñ—Å, —è–∫–æ–º—É –¥–æ–≤—ñ—Ä—è—é—Ç—å</p></div>
        <div class="footer-contacts">
            <div class="mb-2"><a href="tel:+380666881491" style="color: #fff; text-decoration: none; font-weight: bold;"><i class="bi bi-phone me-2"></i> +38 (066) 688-14-91</a></div>
            <div><a href="mailto:r16_info@gmail.com" style="color: rgba(255,255,255,0.8); text-decoration: none;"><i class="bi bi-envelope me-2"></i> r16_info@gmail.com</a></div>
        </div>
        <div class="schedule-block">
            <div class="fw-bold text-warning mb-1"><i class="bi bi-clock-history me-1"></i> –ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏:</div>
            <div class="d-flex justify-content-center gap-3 flex-wrap"><span>–ü–Ω‚Äì–ü—Ç: 09:00 ‚Äì 19:00</span><span>–°–±: 10:00 ‚Äì 16:00</span><span style="color: #ff6b6b;">–ù–¥: –í–∏—Ö—ñ–¥–Ω–∏–π</span></div>
        </div>
        <div class="mt-4" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; font-size: 0.9rem;">
            <a href="{% url 'about' %}" style="color: rgba(255,255,255,0.6); text-decoration: none;">–ü—Ä–æ –Ω–∞—Å</a>
            <a href="{% url 'delivery_payment' %}" style="color: rgba(255,255,255,0.6); text-decoration: none;">–î–æ—Å—Ç–∞–≤–∫–∞</a>
            <a href="{% url 'warranty' %}" style="color: rgba(255,255,255,0.6); text-decoration: none;">–ì–∞—Ä–∞–Ω—Ç—ñ—è</a>
            <a href="{% url 'contacts' %}" style="color: rgba(255,255,255,0.6); text-decoration: none;">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
        </div>
    </div>
    <hr style="opacity: 0.2; margin: 20px auto; max-width: 200px;">
    <p class="small opacity-50 mb-0">Copyright ¬© 2025 R16.com.ua</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const hamburgerButton = document.getElementById('hamburger-button');
    const mobileMenu = document.getElementById('mobile-menu');
    document.addEventListener('click', function(event) {
        if (!mobileMenu.contains(event.target) && !hamburgerButton.contains(event.target) && mobileMenu.classList.contains('is-active')) {
            mobileMenu.classList.remove('is-active');
            hamburgerButton.querySelectorAll('span')[1].style.opacity = '1';
        }
    });
    hamburgerButton.addEventListener('click', function() {
        mobileMenu.classList.toggle('is-active');
    });
</script>

<style>
    .tire-bot-btn { width: 50px; height: 50px; background: #1a1a1a; border: 2px dashed #666; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 22px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: 0.4s; position: relative; z-index: 100; }
    .tire-bot-btn:hover { transform: rotate(180deg) scale(1.1); border-color: #999; }
    .tire-bot-btn::after { content: ''; position: absolute; width: 36px; height: 36px; border-radius: 50%; border: 1px solid #444; }
    .floating-bot { position: fixed; bottom: 30px; right: 30px; z-index: 9999; width: 65px; height: 65px; }
    .floating-bot::after { width: 48px; height: 48px; }

    .chat-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
    .chat-window { width: 90%; max-width: 400px; height: auto; min-height: 500px; border-radius: 20px; background: rgba(255,255,255,0.95); box-shadow: 0 20px 50px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; animation: botPop 0.3s ease-out; }
    @keyframes botPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .chat-header { padding: 15px 20px; background: rgba(255,255,255,0.8); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
    .chat-body { padding: 20px; flex: 1; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; max-height: 60vh; }
    .msg { padding: 12px 16px; border-radius: 12px; font-size: 0.95rem; max-width: 85%; }
    .msg-bot { background: #f1f3f5; align-self: flex-start; border-bottom-left-radius: 2px; }
    .msg-user { background: #0d6efd; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }

    .size-inputs { display: flex; gap: 5px; margin-top: 10px; }
    .size-input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 10px; text-align: center; font-weight: bold; font-size: 1.1rem; }
    
    .chat-suggestions { display: flex; flex-direction: column; gap: 8px; margin-top: 5px; }
    .suggestion-btn { background: #fff; border: 1px solid #dee2e6; padding: 12px; border-radius: 12px; text-align: left; cursor: pointer; font-weight: 600; transition: 0.2s; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .suggestion-btn:hover { background: #0d6efd; color: white; border-color: #0d6efd; }
    
    .typing { display: none; align-self: flex-start; background: white; padding: 10px 15px; border-radius: 15px; }
    .dot { display: inline-block; width: 6px; height: 6px; background: #bbb; border-radius: 50%; margin: 0 2px; animation: jump 1.4s infinite; }
    .dot:nth-child(2) { animation-delay: 0.2s; } .dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
</style>

<div class="tire-bot-btn floating-bot" onclick="openChat()"><i class="bi bi-robot"></i></div>

<div id="chatOverlay" class="chat-overlay">
    <div class="chat-window">
        <div class="chat-header">
            <h6 class="mb-0 fw-bold">ü§ñ R16 –ï–∫—Å–ø—Ä–µ—Å-–ø—ñ–¥–±—ñ—Ä</h6>
            <button onclick="closeChat()" class="btn-close"></button>
        </div>

        <div class="chat-body" id="chatBody">
            <div class="msg msg-bot">–ü—Ä–∏–≤—ñ—Ç! üëã –Ø –¥–æ–ø–æ–º–æ–∂—É –∑–Ω–∞–π—Ç–∏ —à–∏–Ω–∏.</div>
            
            <div id="stepSize">
                <div class="msg msg-bot">–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä:</div>
                <div class="size-inputs">
                    <input type="number" id="botW" class="size-input" placeholder="205">
                    <input type="number" id="botP" class="size-input" placeholder="55">
                    <input type="number" id="botD" class="size-input" placeholder="16">
                </div>
                <button class="btn btn-primary w-100 mt-3 rounded-pill fw-bold" onclick="validateSize()">–î–∞–ª—ñ <i class="bi bi-arrow-right"></i></button>
            </div>

            <div id="stepBudget" style="display: none;">
                <div class="msg msg-bot">–Ø–∫–∏–π —É –≤–∞—Å –±—é–¥–∂–µ—Ç? üí∞</div>
                <div class="chat-suggestions">
                    <div class="suggestion-btn" onclick="stepBudgetDone('cheap', 'üí∏ –•–æ—á—É –¥–µ—à–µ–≤—à–µ')">üí∏ –•–æ—á—É –¥–µ—à–µ–≤—à–µ</div>
                    <div class="suggestion-btn" onclick="stepBudgetDone('medium', '‚öñÔ∏è –¶—ñ–Ω–∞ / –Ø–∫—ñ—Å—Ç—å')">‚öñÔ∏è –¶—ñ–Ω–∞ / –Ø–∫—ñ—Å—Ç—å</div>
                    <div class="suggestion-btn" onclick="stepBudgetDone('expensive', 'üíé –¢–æ–ø –ë—Ä–µ–Ω–¥–∏')">üíé –¢–æ–ø –ë—Ä–µ–Ω–¥–∏</div>
                </div>
            </div>

            <div id="stepSeason" style="display: none;">
                <div class="msg msg-bot">–ù–∞ —è–∫–∏–π —Å–µ–∑–æ–Ω –ø–æ—Ç—Ä—ñ–±–Ω—ñ? üöó</div>
                <div class="chat-suggestions">
                    <div class="suggestion-btn" onclick="stepSeasonDone('winter')">‚ùÑÔ∏è –ó–∏–º–æ–≤—ñ</div>
                    <div class="suggestion-btn" onclick="stepSeasonDone('summer')">‚òÄÔ∏è –õ—ñ—Ç–Ω—ñ</div>
                    <div class="suggestion-btn" onclick="stepSeasonDone('all-season')">üå§ –í—Å–µ—Å–µ–∑–æ–Ω–Ω—ñ</div>
                </div>
            </div>

            <div class="typing" id="typingDots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
        </div>
    </div>
</div>

<script>
    const chatOverlay = document.getElementById('chatOverlay');
    const chatBody = document.getElementById('chatBody');
    const typingDots = document.getElementById('typingDots');
    
    // –°—Ç–∞–Ω –±–æ—Ç–∞
    let botState = { width: '', profile: '', diameter: '', budget: '', season: '' };

    function openChat() { chatOverlay.style.display = 'flex'; }
    function closeChat() { chatOverlay.style.display = 'none'; }
    chatOverlay.addEventListener('click', (e) => { if(e.target === chatOverlay) closeChat(); });

    // 1. –ü–ï–†–ï–í–Ü–†–ö–ê –†–û–ó–ú–Ü–†–£
    function validateSize() {
        const w = document.getElementById('botW').value;
        const p = document.getElementById('botP').value;
        const d = document.getElementById('botD').value;

        if (!w || !p || !d) { alert("–í–≤–µ–¥—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä!"); return; }

        botState.width = w; botState.profile = p; botState.diameter = d;

        addUserMsg(`${w} / ${p} R${d}`);
        document.getElementById('stepSize').style.display = 'none';
        
        // –ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫ —á–µ—Ä–µ–∑ –∞–Ω—ñ–º–∞—Ü—ñ—é
        showTypingAndSwitch('stepBudget');
    }

    // 2. –û–ë–†–û–ë–ö–ê –ë–Æ–î–ñ–ï–¢–£
    function stepBudgetDone(value, text) {
        botState.budget = value;
        document.getElementById('stepBudget').style.display = 'none'; // –•–æ–≤–∞—î–º–æ –±–ª–æ–∫ –∑ –∫–Ω–æ–ø–∫–∞–º–∏
        addUserMsg(text);
        
        // –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —Å–µ–∑–æ–Ω—É
        showTypingAndSwitch('stepSeason');
    }

    // 3. –§–Ü–ù–Ü–® (–°–ï–ó–û–ù)
    function stepSeasonDone(seasonValue) {
        document.getElementById('stepSeason').style.display = 'none';
        botState.season = seasonValue;
        
        let seasonText = seasonValue === 'winter' ? '–ó–∏–º–æ–≤—ñ' : (seasonValue === 'summer' ? '–õ—ñ—Ç–Ω—ñ' : '–í—Å–µ—Å–µ–∑–æ–Ω–Ω—ñ');
        addUserMsg(seasonText);

        const botMsg = document.createElement('div');
        botMsg.className = 'msg msg-bot';
        botMsg.innerHTML = '–®—É–∫–∞—é –≤–∞—Ä—ñ–∞–Ω—Ç–∏... üîç';
        chatBody.appendChild(botMsg);
        
        // –ü–ï–†–ï–ù–ê–ü–†–ê–í–õ–ï–ù–ù–Ø
        setTimeout(() => {
            let url = `{% url 'catalog' %}?width=${botState.width}&profile=${botState.profile}&diameter=${botState.diameter}&season=${botState.season}`;
            if (botState.budget) {
                url += `&ordering=${botState.budget}`;
            }
            window.location.href = url;
        }, 1000);
    }

    // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
    function addUserMsg(text) {
        const msg = document.createElement('div');
        msg.className = 'msg msg-user';
        msg.innerText = text;
        chatBody.insertBefore(msg, typingDots);
    }

    function showTypingAndSwitch(nextId) {
        typingDots.style.display = 'block';
        chatBody.scrollTop = chatBody.scrollHeight;
        
        setTimeout(() => {
            typingDots.style.display = 'none';
            document.getElementById(nextId).style.display = 'block';
            chatBody.scrollTop = chatBody.scrollHeight;
        }, 600);
    }
</script>

</body>
</html>
