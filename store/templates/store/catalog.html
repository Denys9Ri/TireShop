{% extends "store/base.html" %}

{% block title %}TireShop.ua - Каталог Шин{% endblock %}

{% block content %}

    <button class="filter-toggle-btn" id="open-filter-btn">
        ☰ Фільтрувати товари
    </button>

    <div class="filter-overlay" id="filter-overlay"></div>

    <div class="filter-sidebar" id="filter-sidebar">
        
        <div class="filter-sidebar-header">
            <h3>Фільтр товарів</h3>
            <button class="filter-close-btn" id="close-filter-btn">&times;</button>
        </div>

        <form class="filter-sidebar-content" method="get" action=".">
            
            <div class="filter-container">
                <div class="filter-step">
                    <h4>1. Виберіть Бренд</h4>
                    <div class="filter-options">
                        <input type="radio" name="brand" value="" id="brand-all" {% if not selected_brand %}checked{% endif %}>
                        <label for="brand-all">Всі Бренди</label>
                        {% for brand in all_brands %}
                            <input type="radio" name="brand" value="{{ brand.id }}" id="brand-{{ brand.id }}" {% if brand.id == selected_brand %}checked{% endif %}>
                            <label for="brand-{{ brand.id }}">{{ brand.name }}</label>
                        {% endfor %}
                    </div>
                </div>

                <div class="filter-step">
                    <h4>2. Виберіть Ширину</h4>
                    <div class="filter-options">
                        <input type="radio" name="width" value="" id="width-all" {% if not selected_width %}checked{% endif %}>
                        <label for="width-all">Всі</label>
                        {% for width in all_widths %}
                            <input type="radio" name="width" value="{{ width }}" id="width-{{ width }}" {% if width == selected_width %}checked{% endif %}>
                            <label for="width-{{ width }}">{{ width }}</label>
                        {% endfor %}
                    </div>
                </div>
                <div class="filter-step">
                    <h4>3. Виберіть Профіль</h4>
                    <div class="filter-options">
                        <input type="radio" name="profile" value="" id="profile-all" {% if not selected_profile %}checked{% endif %}>
                        <label for="profile-all">Всі</label>
                        {% for profile in all_profiles %}
                            <input type="radio" name="profile" value="{{ profile }}" id="profile-{{ profile }}" {% if profile == selected_profile %}checked{% endif %}>
                            <label for="profile-{{ profile }}">{{ profile }}</label>
                        {% endfor %}
                    </div>
                </div>
                <div class="filter-step">
                    <h4>4. Виберіть Діаметр</h4>
                    <div class="filter-options">
                        <input type="radio" name="diameter" value="" id="diameter-all" {% if not selected_diameter %}checked{% endif %}>
                        <label for="diameter-all">Всі</label>
                        {% for diameter in all_diameters %}
                            <input type="radio" name="diameter" value="{{ diameter }}" id="diameter-{{ diameter }}" {% if diameter == selected_diameter %}checked{% endif %}>
                            <label for="diameter-{{ diameter }}">R{{ diameter }}</label>
                        {% endfor %}
                    </div>
                </div>
                <div class="filter-step">
                    <h4>5. Виберіть Сезон</h4>
                    <div class="filter-options">
                        <input type="radio" name="season" value="" id="season-all" {% if not selected_season %}checked{% endif %}>
                        <label for="season-all">Всі</label>
                        {% for key, name in all_seasons %}
                            <input type="radio" name="season" value="{{ key }}" id="season-{{ key }}" {% if key == selected_season %}checked{% endif %}>
                            <label for="season-{{ key }}">{{ name }}</label>
                        {% endfor %}
                    </div>
                </div>
            </div> 
            
            <div class="filter-sidebar-footer">
                <button type="submit" class="filter-submit-btn">Застосувати</button>
                <a href="{% url 'catalog' %}" class="filter-reset-btn">Скинути</a>
            </div>
            
        </form>
    </div> <div class="product-list">
        
        {% if page_obj %}
            
            {% for product in page_obj %}
                <div class="product-card">
                    
                    {% if product.photo_url %}
                        <img src="{{ product.photo_url }}" alt="{{ product.name }}">
                    {% else %}
                        <img src="https://via.placeholder.com/250x200.png?text=TireShop.ua" alt="No image">
                    {% endif %}
                    
                    <h3>{{ product.brand.name }} {{ product.name }}</h3>
                    <p class="size">{{ product.width }}/{{ product.profile }} R{{ product.diameter }}</p>
                    <p class="season">{{ product.get_seasonality_display }}</p>
                    
                    {% if product.stock_quantity > 5 %}
                        <p class="stock-available">В наявності (багато)</p>
                    {% elif product.stock_quantity > 0 %}
                        <p class="stock-ending">Закінчується ({{ product.stock_quantity }} шт.)</p>
                    {% else %}
                        <p class="stock-unavailable">Немає в наявності</p>
                    {% endif %}
                    
                    <div class="price">{{ product.price }} грн.</div>
                    
                    <form action="{% url 'store:cart_add' product.id %}" method="post">
                        {% csrf_token %} 
                        <button type="submit" class="btn-buy">Купити</button>
                    </form>
                    
                </div>
            {% endfor %}
        
        {% else %}
            <p>На жаль, за вашим запитом шин не знайдено.</p>
        {% endif %}
        
    </div> <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?{{ filter_params }}&page={{ page_obj.previous_page_number }}">&larr; Попередня</a>
            {% else %}
                <span class="disabled">&larr; Попередня</span>
            {% endif %}

            <span class="current">
                Сторінка {{ page_obj.number }} з {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?{{ filter_params }}&page={{ page_obj.next_page_number }}">Наступна &rarr;</a>
            {% else %}
                <span class="disabled">Наступна &rarr;</span>
            {% endif %}
        </span>
    </div>

    <script>
        const openBtn = document.getElementById('open-filter-btn');
        const closeBtn = document.getElementById('close-filter-btn');
        const sidebar = document.getElementById('filter-sidebar');
        const overlay = document.getElementById('filter-overlay');
        function openFilter() {
            sidebar.classList.add('is-active');
            overlay.classList.add('is-active');
        }
        function closeFilter() {
            sidebar.classList.remove('is-active');
            overlay.classList.remove('is-active');
        }
        openBtn.addEventListener('click', openFilter);
        closeBtn.addEventListener('click', closeFilter);
        overlay.addEventListener('click', closeFilter); 
    </script>
{% endblock %}
