{% extends "store/base.html" %}

{% block title %}ShinaMania.ua - Оформлення замовлення{% endblock %}

{% block content %}
<div class="checkout-page">
    <div class="cart-page__header">
        <h2>Оформлення замовлення</h2>
        <p class="cart-page__subtitle">Заповніть дані доставки, а ми швидко підтвердимо заявку</p>
    </div>

    <div class="checkout-layout">
        <form method="post" class="checkout-form glass-card">
            {% csrf_token %}
            <fieldset class="checkout-section">
                <legend>1. Спосіб доставки</legend>
                <div class="shipping-options">
                    <label class="shipping-option">
                        <input type="radio" id="shipping_pickup" name="shipping_type" value="pickup" checked
                               onchange="toggleShippingFields()">
                        <span class="shipping-option__body">
                            <span class="shipping-option__title">Самовивіз (м. Київ)</span>
                            <span class="shipping-option__hint">Заберіть шини у зручний час зі складу</span>
                        </span>
                    </label>
                    <label class="shipping-option">
                        <input type="radio" id="shipping_np" name="shipping_type" value="nova_poshta"
                               onchange="toggleShippingFields()">
                        <span class="shipping-option__body">
                            <span class="shipping-option__title">Нова Пошта (по Україні)</span>
                            <span class="shipping-option__hint">Доставка по всій Україні до відділення чи поштомату</span>
                        </span>
                    </label>
                </div>
            </fieldset>

            <fieldset id="novaPoshtaFields" class="checkout-section" style="display:none;">
                <legend>2. Дані отримувача "Нова Пошта"</legend>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="full_name">Прізвище та ім'я</label>
                        <input type="text" id="full_name" name="full_name" placeholder="Іван Іваненко">
                    </div>

                    <div class="form-group">
                        <label for="phone">Номер телефону</label>
                        <input type="tel" id="phone" name="phone" placeholder="+38 (0xx) xxx-xx-xx">
                    </div>

                    <div class="form-group">
                        <label for="email">Email (для ТТН)</label>
                        <input type="email" id="email" name="email" placeholder="you@example.com">
                    </div>

                    <div class="form-group">
                        <label for="city">Місто / Село</label>
                        <input type="text" id="city" name="city" placeholder="Київ">
                    </div>

                    <div class="form-group form-group--full">
                        <label for="nova_poshta_branch">Номер відділення або поштомат</label>
                        <input type="text" id="nova_poshta_branch" name="nova_poshta_branch" placeholder="Відділення №12">
                    </div>
                </div>
            </fieldset>

            <fieldset id="pickupFields" class="checkout-section">
                <legend>2. Інформація про самовивіз</legend>
                <p class="checkout-note">Наш менеджер уточнить час видачі на складі в Києві. Вкажіть, як вам зручно отримати замовлення.</p>
                <p class="pickup-address">Адреса — Київ, вул. Володимира Качали, 3. Забрати завтра.</p>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="pickup_name">Ім'я та прізвище</label>
                        <input type="text" id="pickup_name" name="pickup_name" placeholder="Іван Іваненко">
                    </div>
                    <div class="form-group">
                        <label for="pickup_phone">Номер телефону</label>
                        <input type="tel" id="pickup_phone" name="pickup_phone" placeholder="+38 (0xx) xxx-xx-xx">
                    </div>
                </div>
            </fieldset>

            <div class="checkout-actions">
                <a href="{% url 'store:cart_detail' %}" class="btn-secondary">Повернутися до кошика</a>
                <button type="submit" class="btn-checkout">Підтвердити замовлення</button>
            </div>
        </form>

        <aside class="checkout-summary glass-card">
            <h3>Підсумок</h3>
            <div class="checkout-summary__line">
                <span>Товарів у кошику</span>
                <span>{{ cart|length }}</span>
            </div>
            <div class="checkout-summary__line checkout-summary__line--total">
                <span>Сума до оплати</span>
                <span class="checkout-summary__total">{{ cart.get_total_price }} грн.</span>
            </div>
            <p class="checkout-note">Якщо потрібна консультація перед оплатою, ми передзвонимо для підтвердження деталей.</p>
        </aside>
    </div>
</div>

<script>
    function toggleShippingFields() {
        const isNovaPoshta = document.getElementById('shipping_np').checked;
        const npFields = document.getElementById('novaPoshtaFields');
        const pickupFields = document.getElementById('pickupFields');
        const npInputs = npFields.querySelectorAll('input');
        const pickupInputs = [
            document.getElementById('pickup_name'),
            document.getElementById('pickup_phone')
        ];

        if (isNovaPoshta) {
            npFields.style.display = 'block';
            pickupFields.style.display = 'none';

            npInputs.forEach(input => input.required = true);
            pickupInputs.forEach(input => input.required = false);
        } else {
            npFields.style.display = 'none';
            pickupFields.style.display = 'block';

            npInputs.forEach(input => input.required = false);
            pickupInputs.forEach(input => input.required = true);
        }
    }

    document.addEventListener('DOMContentLoaded', toggleShippingFields);
</script>

{% endblock %}
