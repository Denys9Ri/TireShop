<form method="get" action="{% url 'store:catalog' %}">
    {# –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç —ñ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è #}
    {% if search_query %}<input type="hidden" name="query" value="{{ search_query }}">{% endif %}
    {% if request.GET.ordering %}<input type="hidden" name="ordering" value="{{ request.GET.ordering }}">{% endif %}

    <div class="accordion" id="filterAccordion">
        
        {# 1. –°–ï–ó–û–ù #}
        <div class="filter-group">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeason">
                    –°–µ–∑–æ–Ω
                </button>
            </h2>
            <div id="collapseSeason" class="accordion-collapse collapse show">
                <div class="accordion-body">
                    {# üî• –ü–†–ò–ë–†–ê–õ–ò onchange="this.form.submit()" üî• #}
                    <select name="season" class="form-select form-select-sm">
                        <option value="">–ë—É–¥—å-—è–∫–∏–π</option>
                        {% for value, display in all_seasons %}
                            <option value="{{ value }}" {% if value|stringformat:"s" == selected_season|stringformat:"s" %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        {# 2. –†–û–ó–ú–Ü–† (–®–∏—Ä–∏–Ω–∞ / –ü—Ä–æ—Ñ—ñ–ª—å / –î—ñ–∞–º–µ—Ç—Ä) #}
        <div class="filter-group">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSize">
                    –†–æ–∑–º—ñ—Ä
                </button>
            </h2>
            <div id="collapseSize" class="accordion-collapse collapse show">
                <div class="accordion-body">
                    <div class="mb-2">
                        <label class="small text-muted">–®–∏—Ä–∏–Ω–∞</label>
                        {# üî• –ü–†–ò–ë–†–ê–õ–ò onchange üî• #}
                        <select name="width" class="form-select form-select-sm">
                            <option value="">–í—Å—ñ</option>
                            {% for w in all_widths %}
                                <option value="{{ w }}" {% if w|stringformat:"s" == selected_width|stringformat:"s" %}selected{% endif %}>{{ w }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="small text-muted">–ü—Ä–æ—Ñ—ñ–ª—å</label>
                        {# üî• –ü–†–ò–ë–†–ê–õ–ò onchange üî• #}
                        <select name="profile" class="form-select form-select-sm">
                            <option value="">–í—Å—ñ</option>
                            {% for p in all_profiles %}
                                <option value="{{ p }}" {% if p|stringformat:"s" == selected_profile|stringformat:"s" %}selected{% endif %}>{{ p }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="small text-muted">–î—ñ–∞–º–µ—Ç—Ä</label>
                        {# üî• –ü–†–ò–ë–†–ê–õ–ò onchange üî• #}
                        <select name="diameter" class="form-select form-select-sm">
                            <option value="">–í—Å—ñ</option>
                            {% for d in all_diameters %}
                                <option value="{{ d }}" {% if d|stringformat:"s" == selected_diameter|stringformat:"s" %}selected{% endif %}>R{{ d }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        </div>

        {# 3. –ë–†–ï–ù–î #}
        <div class="filter-group border-bottom-0">
             <h2 class="accordion-header">
                 <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBrand">
                     –ë—Ä–µ–Ω–¥
                 </button>
             </h2>
             <div id="collapseBrand" class="accordion-collapse collapse {% if selected_brand_id %}show{% endif %}">
                <div class="accordion-body">
                    {# üî• –ü–†–ò–ë–†–ê–õ–ò onchange üî• #}
                    <select name="brand" class="form-select form-select-sm">
                        <option value="">–í—Å—ñ –±—Ä–µ–Ω–¥–∏</option>
                        {% for brand in all_brands %}
                            <option value="{{ brand.id }}" {% if brand.id|stringformat:"s" == selected_brand_id|stringformat:"s" %}selected{% endif %}>{{ brand.name }}</option>
                        {% endfor %}
                    </select>
                </div>
             </div>
        </div>

    </div>
    
    <div class="d-grid gap-2 mt-3">
        {# –¢–µ–ø–µ—Ä —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Å–ø—Ä–∞—Ü—é—î –¢–Ü–õ–¨–ö–ò –ø—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–Ω–æ–ø–∫–∏ #}
        <button type="submit" class="btn btn-primary btn-sm rounded-pill fw-bold">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
        <a href="{% url 'store:catalog' %}" class="btn btn-light btn-sm rounded-pill text-muted border">–°–∫–∏–Ω—É—Ç–∏</a>
    </div>
</form>
